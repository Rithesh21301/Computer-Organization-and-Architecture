.section .text
.global main
main :
    li t5,1
    slli t5,t5,12
    csrrc zero,mstatus,t5
    srli t5,t5,1
    csrrs zero,mstatus,t5
    srli t5,t5,3
    csrrs zero,medeleg,t5

    la t0,mtrap_handler
    csrw mtvec,t0

    la t0,scode
    csrw mepc,t0
    mret
#return
# la t0,ucode
# csrw sepc,t0
# sret



mtrap_handler:
    csrr s4,mepc
    csrr s5,mcause
    csrr s6,mtvec

    addi s4,s4,4
    csrw mepc ,s4

    mret 


scode:
    la t0,strap_handler
    csrw stvec ,t0

    la t0,ucode
    csrw sepc,t0
    sret


strap_handler:
    csrr s1,sepc
    csrr s2,scause
    csrr s3,stvec

    addi s1,s1,4
    csrw sepc,s1

    ecall
    sret

ucode:

    ecall
    j ucode
